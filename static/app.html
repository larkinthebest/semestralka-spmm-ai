<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Multimedia Tutor</title>
    <link rel="stylesheet" href="/static/app.css" />
  </head>
  <body>
    <div class="container">
      <!-- Left Panel -->
      <div class="left-panel">
        <div class="tutor-section">
          <div class="tutor-controls">
            <div class="tutor-selector">
              <div
                class="tutor-option tutor-enola active"
                onclick="window.selectTutor('enola')"
                title="Enola - Explanation Specialist"
              ></div>
              <div
                class="tutor-option tutor-franklin"
                onclick="window.selectTutor('franklin')"
                title="Franklin - Testing Specialist"
              ></div>
            </div>
            <div class="tutor-controls-right">
              <div class="language-selector">
                <button
                  class="language-btn"
                  onclick="window.toggleLanguageDropdown()"
                  id="languageBtn"
                >
                  ğŸŒ EN
                </button>
                <div class="language-dropdown" id="languageDropdown">
                  <div
                    class="language-option active"
                    onclick="window.selectLanguage('en', 'EN')"
                  >
                    ğŸ‡ºğŸ‡¸ English
                  </div>
                  <div
                    class="language-option"
                    onclick="window.selectLanguage('de', 'DE')"
                  >
                    ğŸ‡©ğŸ‡ª Deutsch
                  </div>
                  <div
                    class="language-option"
                    onclick="window.selectLanguage('sk', 'SK')"
                  >
                    ğŸ‡¸ğŸ‡° SlovenÄina
                  </div>
                </div>
              </div>
              <button
                class="theme-toggle"
                onclick="window.toggleTheme()"
                id="themeToggle"
              >
                ğŸŒ™
              </button>
            </div>
          </div>
          <div class="tutor-avatar" id="tutorAvatar"></div>
          <div class="tutor-name" id="tutorName">Enola</div>
          <div class="tutor-description" id="tutorDescription">
            I will explain the world to you
          </div>
        </div>

        <div class="user-section" id="userSection">
          <button id="userProfileButton" class="user-profile-button" onclick="console.log('DEBUG: userProfileButton clicked'); event.stopPropagation(); window.openUserProfile()">
            ğŸ‘¤ User Profile
          </button>
          <div
            id="userInfo"
            class="user-info"
          >
            ğŸ‘¤ Guest User
          </div>
          <div id="authActions" class="auth-actions">
            <a href="/auth">Sign In</a>
          </div>
        </div>

        <div class="chats-section">
          <div class="section-header">
            <div class="section-title">Chats</div>
            <button class="add-btn" onclick="window.addNewChat()">+</button>
          </div>
          <div id="chatList">
            <div
              class="chat-item active"
              data-chat-id="1"
              onclick="window.switchToChat(1)"
            >
              <span>New Chat</span>
              <div class="item-actions">
                <button
                  class="action-btn"
                  onclick="event.stopPropagation(); window.renameChat(1)"
                >
                  âœï¸
                </button>
                <button
                  class="action-btn"
                  onclick="event.stopPropagation(); window.deleteChat(1)"
                >
                  ğŸ—‘ï¸
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="assets-section">
          <div class="section-header">
            <div class="section-title">Assets</div>
            <button class="add-btn" onclick="window.addAsset()">+</button>
          </div>
          <div id="assetList">
            <div class="no-assets-message">No assets uploaded</div>
          </div>
        </div>
      </div>

      <!-- Middle Panel -->
      <div class="middle-panel" id="middlePanel">
        <div class="drop-overlay" id="dropOverlay">
          ğŸ“ Drop files here to attach to message
        </div>

        <div class="mode-selector">
          <button
            class="mode-btn explanation active"
            onclick="window.switchToExplanationMode()"
            id="explanationModeBtn"
          >
            ğŸ§  Explanation Mode
          </button>
          <button
            class="mode-btn testing"
            onclick="window.switchToTestingMode()"
            id="testingModeBtn"
          >
            ğŸ“ Testing Mode
          </button>
        </div>

        <div class="chat-area" id="chatArea">
          <div class="message" id="initialWelcomeMessage">
            <div class="message-avatar" id="initialAvatar"></div>
            <div class="message-content">
              Hello! I'm your AI tutor. Upload some files and I'll help you
              learn from them. Use <strong>Explanation Mode</strong> to ask
              questions and get detailed answers, or switch to
              <strong>Testing Mode</strong> to practice with quizzes.
              <br /><br />
              You can drag and drop files directly into the chat to attach them
              to your messages!
            </div>
          </div>
        </div>

        <!-- Quiz Settings Panel (hidden by default, shown in testing mode) -->
        <div id="quizSettingsPanel" class="quiz-settings-panel">
          <h3>Quiz Settings</h3>
          <div class="quiz-settings-inline">
            <div class="setting-item">
              <label for="quizNumQuestions">Questions:</label>
              <input
                type="number"
                id="quizNumQuestions"
                value="5"
                min="1"
                max="20"
              />
            </div>
            <div class="setting-item">
              <label for="quizType">Type:</label>
              <select id="quizType">
                <option value="multiple_choice">Multiple Choice</option>
                <option value="true_false">True/False</option>
                <option value="fill_in_the_blank">Fill-in-the-Blank</option>
                <option value="short_answer">Short Answer</option>
              </select>
            </div>
            <div class="setting-item">
              <label for="quizDifficulty">Difficulty:</label>
              <select id="quizDifficulty">
                <option value="any">Any</option>
                <option value="easy">Easy</option>
                <option value="medium">Medium</option>
                <option value="hard">Hard</option>
              </select>
            </div>
          </div>
          <div class="quiz-settings-actions">
            <!-- The "Apply" button is removed as settings will auto-apply -->
          </div>
        </div>

        <div class="input-section">
          <div class="attached-files" id="attachedFiles"></div>
          <div class="input-container explanation" id="inputContainer">
            <button class="attach-btn" onclick="window.attachFile()">ğŸ“</button>
            <textarea
              class="message-input"
              id="messageInput"
              placeholder="Ask me anything about your uploaded content..."
              onkeydown="window.handleKeyPress(event)"
              rows="1"
            ></textarea>
            <button
              class="send-btn explanation"
              id="sendBtn"
              onclick="window.sendMessage()"
            >
              â¤
            </button>
          </div>
        </div>
      </div>

      <!-- Right Panel -->
      <div class="right-panel">
        <div class="source-panel">
          <h3>ğŸ“š Sources</h3>
          <div id="sourceList">
            <div class="no-sources-message">
              Sources will appear here when you ask questions
            </div>
          </div>
        </div>

        <!-- Quiz Panel (hidden by default) -->
        <div id="quizPanel">
          <h3>ğŸ“ Interactive Quiz</h3>
          <div id="quizContainer"></div>
        </div>
      </div>
    </div>

    <!-- Hidden file inputs -->
    <input
      type="file"
      id="fileInput"
      class="hidden-input"
      title="Upload Asset"
      multiple
      accept=".pdf,.docx,.txt,.md,.jpg,.jpeg,.png,.gif,.bmp,.mp3,.wav,.m4a,.ogg,.mp4,.avi,.mov,.mkv,.webm"
      onchange="window.handleFileUpload(event, 'asset')"
    />

    <input
      type="file"
      id="attachInput"
      class="hidden-input"
      title="Attach to Message"
      multiple
      accept=".pdf,.docx,.txt,.md,.jpg,.jpeg,.png,.gif,.bmp,.mp3,.wav,.m4a,.ogg,.mp4,.avi,.mov,.mkv,.webm"
      onchange="window.handleFileUpload(event, 'attach')"
    />

    <!-- Modals -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- User Profile Modal -->
    <div id="userProfileModal" class="modal">
      <div class="modal-content">
        <div class="user-profile-header">
          <h3>ğŸ‘¤ User Profile</h3>
          <button
            onclick="window.closeModal('userProfileModal')"
            class="user-profile-close-btn"
          >
            &times;
          </button>
        </div>

        <!-- New two-column layout container -->
        <div class="profile-content-grid">
          <!-- Left Column: Chats & Assets -->
          <div class="profile-column">
            <h4 class="profile-section-title">ğŸ’¬ All Chats</h4>
            <div id="profileChatList" class="profile-list-container"></div>

            <h4 class="profile-section-title profile-section-title-margin-top">
              ğŸ“š Assets
            </h4>
            <div
              id="profileAssetList"
              class="profile-list-container profile-asset-list"
            ></div>
          </div>

          <!-- Right Column: Quiz History & Stats -->
          <div class="profile-column">
            <h4 class="profile-section-title">ğŸ“Š Quiz History & Stats</h4>
            <div id="profileQuizStats" class="profile-stats-container"></div>
            <div id="profileQuizHistory" class="profile-list-container"></div>
          </div>
        </div>
      </div>
    </div>
    <script type="module" src="/static/api.js"></script>
    <script type="module" src="/static/ui.js"></script>
    <script type="module" src="/static/chat.js"></script>
    <script type="module" src="/static/assets.js"></script>
    <script type="module" src="/static/quiz.js"></script>
    <script type="module" src="/static/profile.js"></script>
    <script type="module" src="/static/app.js"></script>
    <script>
      // MathJax configuration to potentially mitigate storage issues
      window.MathJax = {
        options: {
          enableMenu: false, // Disable the MathJax contextual menu
          ignoreHtmlClass: 'tex2jax_ignore', // Ignore elements with this class
          processHtmlClass: 'tex2jax_process' // Process elements with this class
        },
        tex: {
          inlineMath: [['\\(', '\\)']],
          displayMath: [['\\[', '\\]']],
          processEscapes: true,
          packages: {'[+]': ['noerrors']} // Add noerrors package to prevent errors from stopping rendering
        },
        loader: {
          load: ['input/tex', 'output/chtml', 'ui/menu'] // Removed 'a11y/assistive-mml'
        },
        startup: {
          ready: () => {
            console.log('DEBUG: MathJax is ready!');
            // Manually typeset if needed after the page is fully loaded
            if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
              setTimeout(() => {
                MathJax.typesetPromise();
              }, 500); // Small delay to ensure DOM is ready
            }
          }
        }
      };
    </script>
    <!-- Temporarily disabled MathJax script to debug TypeError -->
    <!--
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>
    -->
  </body>
</html>
